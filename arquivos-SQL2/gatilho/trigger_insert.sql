CREATE TABLE TAB_FATURAMENTO
(DATA_VENDA DATE NULL,TOTAL_VENDA FLOAT);

SELECT * FROM TAB_FATURAMENTO;

DELETE FROM ITENS_NOTAS;
DELETE FROM NOTAS;

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA,IMPOSTO)
VALUES('0104','2021-04-01','1471156710' , '235',0.10);

INSERT INTO ITENS_NOTAS (NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES('0104','1000889',100,10);

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA,IMPOSTO)
VALUES('0103','2021-04-01','1471156710' , '235',0.10);

INSERT INTO ITENS_NOTAS (NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES('0103','1000889',100,10);

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA,IMPOSTO)
VALUES('0102','2021-04-01','1471156710' , '235',0.10);

INSERT INTO ITENS_NOTAS (NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES('0102','1000889',100,10);

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA,IMPOSTO)
VALUES('0105','2021-04-01','1471156710' , '235',0.10);

INSERT INTO ITENS_NOTAS (NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES('0105','1000889',100,10);

DELIMITER //
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON ITENS_NOTAS
FOR EACH ROW BEGIN
   DELETE FROM TAB_FATURAMENTO;
   INSERT INTO TAB_FATURAMENTO
   SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
   NOTAS A INNER JOIN ITENS_NOTAS B ON A.NUMERO = B.NUMERO
   GROUP BY A.DATA_VENDA ;
END //
